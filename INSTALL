## Compiling on Linux, *BSD and macOS

### Prerequisites

Install Rust & Cargo: https://www.rust-lang.org/install.html

On Windows also install msys-git and Visual C++ Build Tools
with Windows 8 SDK enabled, and reboot.

### Building

Get the code:

    # Unix version
    git clone --recursive https://github.com/kornelski/pngquant.git

    # Windows version
    git clone -b msvc --recursive https://github.com/kornelski/pngquant.git

And then build:

    cd pngquant
    cargo build --release

This will create executable in `target/release/pngquant`(`.exe`).

You can build with additional features:

    cargo build --release --features=sse,lcms2

The features are:

 * `sse` — enable use of SSE on x86 CPUs.
 * `lcms2` — compile with support for color profiles via Little CMS.
 * `lcms2-static` — same, but link statically.
 * `cocoa` — compile with support for color profiles via macOS Cocoa.
 * `openmp` — use OpenMP to accelerate conversion. Requires GCC (not Clang).
 * `openmp-static` — same, but link statically.
 * `alloc_system` — produce smaller executable. Requires Rust "nightly".
   Remember to also `strip` the executable if the size is important.

## Compilation with OpenMP

    cargo build --release --features=openmp # or
    cargo build --release --features=openmp-static

On macOS you may need to install gcc (`brew install gcc`) and run `export CC=gcc-7` first,
because clang doesn't support OpenMP (yet).

## Compilation without Cocoa image reader

macOS version can use Cocoa to read images. This adds support for color profiles
and other image formats as input. However, it also disables support for preserving PNG metadata.

    cargo build --release --features=cocoa

## Compilation with Little CMS 2

Little CMS library is used by default.

It's linked dynamically if `pkg-config` is working (e.g. install `liblcms2-dev`).
Otherwise uses static build as a fallback.

Set `export LCMS2_STATIC=1` or build `--features=lcms2-static` to force static linking.

## Compilation of `libimagequant.a` only

If you want to use pngquant's conversion algorithm without loading/saving PNG
files, then you can run `make` or `cargo build` in the `lib/` directory.

The library doesn't need libpng nor zlib.
